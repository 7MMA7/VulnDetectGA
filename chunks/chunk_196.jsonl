{"idx": 204830, "project": "linux", "commit_id": "427215d85e8d1476da1a86b8d67aceb485eb3631", "project_url": "https://github.com/torvalds/linux", "commit_url": "https://github.com/torvalds/linux/commit/427215d85e8d1476da1a86b8d67aceb485eb3631", "commit_message": "ovl: prevent private clone if bind mount is not allowed\n\nAdd the following checks from __do_loopback() to clone_private_mount() as\nwell:\n\n - verify that the mount is in the current namespace\n\n - verify that there are no locked children\n\nReported-by: Alois Wohlschlager <alois1@gmx-topmail.de>\nFixes: c771d683a62e (\"vfs: introduce clone_private_mount()\")\nCc: <stable@vger.kernel.org> # v3.18\nSigned-off-by: Miklos Szeredi <mszeredi@redhat.com>", "target": 1, "func": "struct vfsmount *clone_private_mount(const struct path *path)\n{\n\tstruct mount *old_mnt = real_mount(path->mnt);\n\tstruct mount *new_mnt;\n\n\tif (IS_MNT_UNBINDABLE(old_mnt))\n\t\treturn ERR_PTR(-EINVAL);\n\n\tnew_mnt = clone_mnt(old_mnt, path->dentry, CL_PRIVATE);\n\tif (IS_ERR(new_mnt))\n\t\treturn ERR_CAST(new_mnt);\n\n\t/* Longterm mount to be removed by kern_unmount*() */\n\tnew_mnt->mnt_ns = MNT_NS_INTERNAL;\n\n\treturn &new_mnt->mnt;\n}", "func_hash": 260474936923487005378622883442342647421, "file_name": "namespace.c", "file_hash": 336414911625449496230254298040232985694, "cwe": ["CWE-200"], "cve": "CVE-2021-3732", "cve_desc": "A flaw was found in the Linux kernel's OverlayFS subsystem in the way the user mounts the TmpFS filesystem with OverlayFS. This flaw allows a local user to gain access to hidden files that should not be accessible.", "nvd_url": "https://nvd.nist.gov/vuln/detail/CVE-2021-3732", "file_path": "fs/namespace.c"}
{"idx": 366223, "project": "linux", "commit_id": "427215d85e8d1476da1a86b8d67aceb485eb3631", "project_url": "https://github.com/torvalds/linux", "commit_url": "https://github.com/torvalds/linux/commit/427215d85e8d1476da1a86b8d67aceb485eb3631", "commit_message": "ovl: prevent private clone if bind mount is not allowed\n\nAdd the following checks from __do_loopback() to clone_private_mount() as\nwell:\n\n - verify that the mount is in the current namespace\n\n - verify that there are no locked children\n\nReported-by: Alois Wohlschlager <alois1@gmx-topmail.de>\nFixes: c771d683a62e (\"vfs: introduce clone_private_mount()\")\nCc: <stable@vger.kernel.org> # v3.18\nSigned-off-by: Miklos Szeredi <mszeredi@redhat.com>", "target": 0, "func": "struct vfsmount *clone_private_mount(const struct path *path)\n{\n\tstruct mount *old_mnt = real_mount(path->mnt);\n\tstruct mount *new_mnt;\n\n\tdown_read(&namespace_sem);\n\tif (IS_MNT_UNBINDABLE(old_mnt))\n\t\tgoto invalid;\n\n\tif (!check_mnt(old_mnt))\n\t\tgoto invalid;\n\n\tif (has_locked_children(old_mnt, path->dentry))\n\t\tgoto invalid;\n\n\tnew_mnt = clone_mnt(old_mnt, path->dentry, CL_PRIVATE);\n\tup_read(&namespace_sem);\n\n\tif (IS_ERR(new_mnt))\n\t\treturn ERR_CAST(new_mnt);\n\n\t/* Longterm mount to be removed by kern_unmount*() */\n\tnew_mnt->mnt_ns = MNT_NS_INTERNAL;\n\n\treturn &new_mnt->mnt;\n\ninvalid:\n\tup_read(&namespace_sem);\n\treturn ERR_PTR(-EINVAL);\n}", "func_hash": 181653158150363696384647639482948263222, "file_name": "namespace.c", "file_hash": 152664695598789977004881235289769073267, "cwe": ["CWE-200"], "cve": "CVE-2021-3732", "cve_desc": "A flaw was found in the Linux kernel's OverlayFS subsystem in the way the user mounts the TmpFS filesystem with OverlayFS. This flaw allows a local user to gain access to hidden files that should not be accessible.", "nvd_url": "https://nvd.nist.gov/vuln/detail/CVE-2021-3732", "file_path": "fs/namespace.c"}
